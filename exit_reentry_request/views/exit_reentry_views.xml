<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Tree View -->
    <record id="view_exit_entry_request_list" model="ir.ui.view">
        <field name="name">hr.exit.entry.request.list</field>
        <field name="model">hr.exit.entry.request</field>
        <field name="arch" type="xml">
            <list string="Exit and Re-entry Requests">
                <field name="name"/>
                <field name="employee_id"/>
                <field name="expected_travel_date"/>
                <field name="expected_return_date"/>
                <field name="state"/>
                <field name="cost"/>
                <field name="company_share"/>
                <field name="employee_share"/>
            </list>
        </field>
    </record>

    <!-- Form View -->
    <record id="view_exit_entry_request_form" model="ir.ui.view">
        <field name="name">hr.exit.entry.request.form</field>
        <field name="model">hr.exit.entry.request</field>
        <field name="arch" type="xml">
            <form string="Exit and Re-entry Request">
                <header>
                    <button name="confirm" string="Confirm" type="object" class="oe_highlight" invisible="state != 'new'" 
                            confirm="Are you sure that you want to confirm this exit and re-entry request?" 
                            />
                            <!-- groups="mowzf_hrms.group_confirm_exit" -->
                    <button name="refused_exit" string="Refused" type="object" invisible="state != 'confirmed'"  
                            />
                            <!-- groups="mowzf_hrms.group_refuse_exit" -->
                    <button name="set_to_draft" string="Set to Draft" type="object" invisible="state != 'refused'" 
                            />
                            <!-- groups="mowzf_hrms.group_new_exit" -->
                    <button name="action_open_exit_re_wizard" string="Exit and Reentry Renew" type="object" 
                           invisible="state != 'confirmed'" 
                            />
                            <!-- groups="mowzf_hrms.group_confirm_exit" -->
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button type="object" name="open_requests" icon="fa-flag" class="oe_inline oe_stat_button">
                            <field string="Exit Re-entry requests" name="count_requests" widget="statinfo"/>
                        </button>
                        <button type="object" name="open_leave_requests" icon="fa-plane" class="oe_inline oe_stat_button">
                            <field string="Leave requests" name="count_leave_requests" widget="statinfo"/>
                        </button>
                    </div>
                    <h2>
                        <field name="name" readonly="state in ['confirmed', 'refused']" required="1" placeholder="Description"/>
                        <br/>
                        <field name="code" readonly="1"/>
                    </h2>
                    <group readonly="state in ['confirmed', 'refused']">
                        <group>
                            <!-- domain="[('nationality_type', '=', 'Non-native')]" -->
                            <field name="employee_id" 
                             options="{'no_create':True}" required="1"/>
                            <field name="company_id" groups="base.group_multi_company"/>
                            <!-- <field name="contract_id" groups="hr.group_hr_user"/> --> <!-- Commented out - hr.contract not available in Odoo 19 -->
                            <field name="department_id" groups="hr.group_hr_user"/>
                            <field name="iqama_no" groups="hr.group_hr_user"/>
                            <field name="iqama_expiry_date" groups="hr.group_hr_user"/>
                            <field name="passport" groups="hr.group_hr_user"/>
                            <field name="passport_expiry_date" groups="hr.group_hr_user"/>
                        </group>
                        <group>
                            <field name="reason"/>
                            <field name="reason_desc" invisible="reason != 'other'"  required="reason == 'other'" />
                            <field name="leave_request_id"  invisible="reason != 'leave'" required="reason == 'leave'" 
                                   options="{'no_create':True}" domain="[('state','=','validate')]"/>
                            <field name="exit_entry_type_id" options="{'no_create':True}" required="1"/>
                            <!-- <field name="linked_loan_request_id" readonly="1" groups="hr.group_hr_user"/> -->
                            <field name="one_mutli" required="1"/>
                            <field name="min_months" readonly="1" groups="hr.group_hr_user"/>
                            <field name="min_charge" readonly="1" groups="hr.group_hr_user"/>
                            <field name="additional_month_cost" groups="hr.group_hr_user"/>
                           <field name="air_ticket_request_rentry_id"
                                    options="{'no_create':True}"
                                    invisible="reason != 'air_ticket'"
                                    required="reason == 'air_ticket'"/>
                                    <!-- domain="[('state','=','approved'),('employee_id','=',employee_id)]" -->

                        </group>
                        <group string="Exit and Reentry Details">
                            <field name="expected_travel_date" required="1"/>
                            <field name="last_return_from_leave" groups="hr.group_hr_user"/>
                            <field name="total_working_days" groups="hr.group_hr_user"/>
                            <field name="expected_return_date" readonly="1"/>
                            <field name="emp_benefits" invisible ="total_working_days &lt;= 0"  groups="hr.group_hr_user"/>
                            <field name="net_emp_benefits" groups="hr.group_hr_user" invisible="total_working_days &lt;= 0"  readonly="1"/>
                        </group>
                        <group string="Exit and Reentry Cost">
                            <field name="duration_in_month"/>
                            <field name="cost"/>
                            <field name="family_cost"/>
                            <field name="company_share"/>
                            <field name="employee_share"/>
                            <field name="absheer" invisible="employee_share &gt;= 0"/>
                            <field name="employee_payment_method" 
                                invisible="employee_share &lt;= 0 or absheer" 
                                required="employee_share &gt; 0 and not absheer"/>
                               </group>
                        <group string="Other information">
                            <!-- <field name="loan_type_id" options="{'no_create':True}" groups="hr.group_hr_user"/> -->
                            <field name="limit_reached" invisible="1"/>
                            <!-- <field name="leave_reconciliation_id" options="{'no_create':True}"/> -->
                            <field name="payment_done" groups="account.group_account_user,account.group_account_manager" readonly="state != 'confirmed'"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Old Exit and Re-entry">
                            <group string="Old Exit and Re-entry">
                                <field name="old_exit_entry_ids" nolabel="1" readonly="1"/>
                            </group>
                        </page>
                        <page string="Attachments">
                            <group string="Attachments">
                                <field name="attachment_ids" nolabel="1" readonly="state in ['confirmed', 'refused']" >
                                    <list editable="bottom">
                                        <field name="file_name" invisible="1"/>
                                        <field name="file" required="1" filename="file_name"/>
                                        <field name="name" required="1"/>
                                        <field name="note"/>
                                    </list>
                                </field>
                            </group>
                        </page>
                        <page string="Notes">
                            <group string="Notes">
                                <field name="note" nolabel="1"/>
                            </group>
                        </page>
                        <page string="Approvals">
                            <group>
                                <field name="create_uid"/>
                                <field name="create_date"/>
                                <field name="confirmed_by"/>
                                <field name="confirmed_date" readonly="1"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <!-- Action -->
    <record id="action_exit_entry_request" model="ir.actions.act_window">
        <field name="name">Exit and Re-entry Requests</field>
        <field name="res_model">hr.exit.entry.request</field>
        <field name="view_mode">list,form</field>
        <field name="view_id" ref="view_exit_entry_request_list"/>
        <!-- <field name="search_view_id" ref="hr.view_hr_employee_filter"/> -->
        <!-- <field name="context">{'search_default_new': 1}</field> -->
    </record>

    <!-- Menu -->
    <menuitem id="menu_hr_exit_entry_request_root" name="Exit &amp; Re-entry" sequence="30" web_icon="exit_reentry_request,static/description/icon.png"/>
    <menuitem id="menu_hr_exit_entry_request" name="Exit &amp; Re-entry Requests" parent="exit_reentry_request.menu_hr_exit_entry_request_root" action="action_exit_entry_request" sequence="10"/>
</odoo>