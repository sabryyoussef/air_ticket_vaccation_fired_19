<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

          <!-- 18 invisible="state not in ('approved', 'selected_afish', 'confirmed_measure','measures_devices','completed')"> 
    invisible="state != 'draft'"
    -->

            <!-- عرض قائمة طلبات تذاكر الطيران -->
        <record id="view_air_ticket_request_list" model="ir.ui.view">
            <field name="name">air.ticket.request.list</field>  
            <field name="model">air.ticket.request</field>
            <field name="arch" type="xml">
                <list string="Air Ticket Requests">
                    <field name="employee_id"/>
                    <field name="description"/>
                    <field name="request_reason"/>
                    <field name="air_ticket_type"/>
                    <field name="travel_date"/>
                    <field name="reserve_ticket_for"/>
                    <field name="i_want_to"/>
                    <field name="can_request_exit_rentry"/>
                    <field name="ticket_total_price"/>
                    <field name="company_share"/>
                    <field name="employee_share"/>
                    <field name="payment_done"/>
                    <field name="state"/>
                    </list>
            </field>
        </record>
         <!-- إجراءات النموذج -->
        <record id="action_air_ticket_request" model="ir.actions.act_window">
            <field name="name">Air Ticket Requests</field>
            <field name="res_model">air.ticket.request</field>
            <field name="view_mode">list,form</field>
            <field name="view_id" ref="view_air_ticket_request_list"/>
        </record>

        <!-- عنصر قائمة طلبات تذاكر الطيران -->
        <menuitem id="menu_air_ticket_request" name="Air Ticket Requests" action="action_air_ticket_request" web_icon="air_ticket_request,static/description/icon.png"/>



        <!-- نموذج طلب تذكرة الطيران 
        groups="account.group_account_manager,hr.group_hr_manager"
        -->
        <record id="view_air_ticket_request_form_view" model="ir.ui.view">
            <field name="name">air.ticket.request.form</field>
            <field name="model">air.ticket.request</field>
            <field name="arch" type="xml">
                <form string="Air Ticket Request">
                     <header>
                        <button name="review" string="Data review"    invisible="state != 'new'" type="object" class="oe_highlight"    confirm="Are you sure that you reviewed this air ticket request?" />
                        <button name="approve" string="Final approve" invisible="state != 'reviewed'"   type="object" class="oe_highlight" confirm="Are you sure that you want to approve this air ticket request?" />
                        <button name="refuse" string="Refuse" invisible="state not in ('new','reviewed')"   type="object" confirm="Are you sure that you want to refuse this air ticket request?" />
                        <button name="refuse" string="Refuse" invisible ="state != 'approved'"  type="object" confirm="Are you sure that you want to refuse this air ticket request, if there is any air ticket allocation generated through this air ticket request, the system will auto refuse it." />
                        <button name="reset" string="Set to new" invisible ="state not in ('refused','reviewed')"  type="object" confirm="Are you sure that you want to set this air ticket request to new?"/>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <sheet>
                    <div class="oe_button_box" name="button_box">
                            <button type="object" name="open_old_requests" icon="fa-plane" class="oe_inline oe_stat_button">
                                <field string="Employee Old Air tickets" name="count_old_requests" widget="statinfo"/>
                            </button>
                            <button type="object" name="open_allocations" icon="fa-plane" class="oe_inline oe_stat_button">
                                <field string="Air Ticket Allocation" name="count_allocations" widget="statinfo"/>
                            </button>
                            <button type="object" name="open_leave_requests" icon="fa-arrow-left" class="oe_inline oe_stat_button">
                                <field string="Leave requests" name="count_leave_requests" widget="statinfo"/>
                            </button>
                            <button type="object" name="open_exit_rentry_requests" icon="fa-flag" class="oe_inline oe_stat_button">
                                <field string="Linked exit and re-entry" name="count_exit_rentry" widget="statinfo"/>
                            </button>
                            <button type="object" name="open_loan_request" icon="fa-money" class="oe_inline oe_stat_button" invisible="employee_share &gt; 0 or employee_share_method != 'debit'" >
                                <field string="Loan request" name="count_loan_request" widget="statinfo"/>
                            </button>
                        </div>
                        <group>
                            <group>
                                <field name="name" groups="hr.group_hr_user"/>
                                <field name="description" readonly="state not in ['new','reviewed']" />
                                <field name="employee_id" options="{'no_create': True}" readonly="state not in ['new','reviewed']"  />
                                <!-- <field name="manager_id" options="{'no_create': True}" readonly="state not in ['new','reviewed']"  /> -->
                                <!-- <field name="branch_id" groups="base.group_no_one" readonly="1" force_save="1"/> -->
                                <field name="company_id" groups="base.group_multi_company"/>
                                <field name="department_id" groups="base.group_no_one" readonly="1" force_save="1"/>
                                <field name="job_id" groups="base.group_no_one" readonly="1" force_save="1"/>
                                <field name="country_id" groups="base.group_no_one" readonly="1" force_save="1"/>
                                <field name="employee_nationality"  force_save="1"/>
                                <field name="iqama_id" readonly="1" force_save="1" groups="base.group_no_one"/>
                                <field name="iqama_expiry_date" readonly="1" force_save="1" groups="base.group_no_one"/>
                                <field name="passport_no" readonly="1" force_save="1" groups="base.group_no_one"/>
                                <field name="passport_expiry_date" readonly="1" force_save="1" groups="base.group_no_one"/>
                              <field name="request_reason" readonly="state in ['new','reviewed']" />
                                  <field name="reason_detail" invisible ="request_reason != 'Other'" required="request_reason == 'Other'" />
                               <!-- <field name="leave_request" options="{'no_create': True}" domain="[['state','=','validate'],['employee_id','=',employee_id],                                         ['create_air_ticket_request','=','yes'],['air_ticket_id','=',False]]" invisible="request_reason != 'leave" invisible ="request_reason != 'leave'" required ="request_reason == 'leave'" readonly="state not in ['new','reviewed']" context="{'form_view_ref':'mowzf_hrms.leave_request_form_manager'}"/> -->
                                <field name="air_ticket_type" options="{'no_create': True}" required="contract_type_equal_leave_type == False" readonly ="state  == 'approved'"  domain="[['nationality','in',[employee_nationality,'All Nationalities']],['state','=','Approved'],['type','=','non-annual']]"/>
                                <field name="show_remaining" invisible="1"/>
                                 <label for="current_air_ticket_balance" invisible ="show_remaining != True"/>
                                <div invisible ="show_remaining != True" >
                                    <field name="current_air_ticket_balance" readonly="1" force_save="1" class="oe_inline"/>
                                    months
                                </div>
                              <label for="deduct" invisible ="show_remaining != True" />
                                <div invisible ="show_remaining != True" >
                                    <field name="deduct" class="oe_inline" readonly="state not in ['new','reviewed']" />
                                    months
                                </div>
                                  <label for="remaining_balance" invisible ="show_remaining != True"/>
                                <div invisible ="show_remaining != True">
                                    <field name="remaining_balance" readonly="1" force_save="1" class="oe_inline"/>
                                    months
                                </div>
                                 <button string="Refresh data" name="get_remaining" type="object" invisible="show_remaining != True or state in ('approved','refused')" confirm="Attention,                                 The purpose from this button is to re-load employee air ticket balance. Employee balance may change if you refresh data"/>
                                <div/>
                               <!-- <field name="loan_request_id" readonly="1" force_save="1" groups="hr.group_hr_user" invisible="loan_request_id == False"/> -->
                                <field name="air_ticket_type_can_request_exit_rentry" invisible="1"/>
                                <hr/>
                                <field name="request_date" groups="hr.group_hr_user" readonly="state not in ['new','reviewed']" />
                                 <field name="last_return_from_leave" groups="hr.group_hr_user" readonly="state not in ['new','reviewed']"/>
                               <field name="total_working_days" groups="hr.group_hr_user" readonly="state not in ['new','reviewed']"/>
                            
                            </group>
                            <group>
                                 <label for="leave_from" string="Leave start / End date"/>
                                  <hr/>     
                                <div invisible="request_reason not in ('leave','Deputation / business trip')">
                                    <field name="leave_from" readonly="1" force_save="1" class="oe_inline"/>
                                    <label for="leave_from" string="-" class="oe_inline"/>
                                    <field name="leave_to" readonly="1" force_save="1" class="oe_inline"/>
                                </div>
                                <field name="travel_date" readonly="state not in ['new','reviewed']"/>
                                <field name="expected_return_date" readonly="1" force_save="1"/>
                                <!-- <field name="contract_id" groups="hr.group_hr_user"/> --> <!-- Commented out - hr.contract not available in Odoo 19 -->
                               <field name="contract_leave_policy" groups="base.group_no_one"/>
                                 <field name="air_ticket_policy" groups="base.group_no_one"/>
                                <field name="reserve_ticket_for" readonly="relatives_tickets == 'Never allow tickets for relatives' or state not in ['new','reviewed']"  force_save="1"/>
                                <field name="cash_allowed"/>
                                <field name="i_want_to"  readonly="cash_allowed == 'No' or state not in ['new','reviewed']"/>
                                <field name="payment_time" invisible="i_want_to != 'Cash'"  readonly ="state =='approved' or i_want_to != 'Cash'"  force_save="1"/>
                               <field name="paid_through_reconciliation" groups="base.group_no_one" readonly="state not in ['new','reviewed']"/>
                              
                                             <field name="can_request_exit_rentry"
                                                    readonly="employee_nationality == 'Non-native' and i_want_to == 'cash' and air_ticket_type_can_request_exit_rentry == 'yes' or state not in ['new','reviewed']"
                                                    required="employee_nationality != 'Non-native' and i_want_to != 'cash' and air_ticket_type_can_request_exit_rentry != 'yes'"
                                                />
                                 <!-- <field name="linked_exit_rentry_id" readonly="1" force_save="1" invisible="employee_nationality != 'Non-native' or can_request_exit_rentry != 'yes' or loan_request_id == False" /> -->
                          
                                <!-- <field name="linked_mission_id" readonly="1" force_save="1"/> -->
                                 <field name="number_of_relatives" invisible="relatives_tickets != 'Allow tickets for relatives'" groups="hr.group_hr_user" readonly="1" force_save="1"/>
                               <!-- <field name="batch_id" readonly="1" force_save="1"/>-->
                                <field name="payment_done" groups="account.group_account_user,account.group_account_manager" readonly="state!='approved'" /> 
                            
                            </group>
                             <group>
                                <field name="leave_request_type_id" invisible="1"/>
                                <field name="contract_type_equal_leave_type" />
                                 <field name="ticket_allowance_per_contract" readonly="1" force_save="1" invisible="request_reason != 'Air Ticket Cash Allowance'"/>
                                <field name="ticket_total_price" readonly="state not in ['new','reviewed']" force_save="1"/>
                              <field name="company_share" invisible="i_want_to != 'Cash'" readonly="state not in ['new','reviewed']" />
                                 <field name="employee_share" invisible="i_want_to != 'Cash'" readonly="state not in ['new','reviewed']" />
                               <field name="employee_share_method" readonly="state not in ['new','reviewed']"  invisible="employee_share &lt; 1" required="employee_share &gt; 0 and i_want_to == 'Reserve a ticket through company'" />
                               <!--   <field name="loan_type_id" readonly="1" force_save="1" groups="base.group_no_one"/>-->
                                <field name="relatives_tickets" /> 
                            </group>
                        </group>
                        <notebook>
                            <page string="Air Ticket Details">
                                <field name="air_ticket_details">
                                    <list create="false" delete="false" editable="bottom">
                                        <field name="check_box"/>
                                        <field name="name" readonly="1" force_save="1"/>
                                        <field name="name_in_passport" required="check_box == True" />
                                        <field name="relation" readonly="1" force_save="1"/>
                                        <field name="ticket_type" readonly="check_box == False"  force_save="1"/>
                                        <field name="departure_date"/>
                                        <field name="departure_airport"/>
                                        <field name="flight_number"/>
                                        <field name="airlines"/>
                                        <field name="return_date" readonly="ticket_type != 'Return'" />
                                        <field name="return_airport" readonly="ticket_type != 'Return'"/>
                                        <field name="return_flight_number" readonly="ticket_type != 'Return'"/> 
                                        <field name="return_airlines" readonly="ticket_type != 'Return'" />

                                        <field name="ticket_price" readonly="check_box == False"/>
                                        <field name="notes"/>
                                        <field name="date_of_birth" invisible="1"/>
                                    </list>
                                </field>
                            </page>
                            <page string="Other information" groups="hr.group_hr_user">
                                <group>
                                    <group>
                                        <field name="create_date" readonly="1" force_save="1"/>
                                        <field name="create_uid" readonly="1" force_save="1"/>
                                    </group>
                                    <group>
                                        <field name="reviewed_by"/>
                                        <field name="reviewed_on"/>
                                        <field name="confirmed_by"/>
                                        <field name="confirmed_on"/>
                                    </group>
                                    <group>
                                        <field name="skip_valid_approve_req" groups="hr.group_hr_manager" readonly="state not in ['new','reviewed']"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Old air tickets">
                                <group>
                                
                                 <hr/>
                                    <field name="old_tickets_request_ids" nolabel="1" readonly="1" force_save="1"/>
                                      
                                </group>
                            </page>
                            <page string="Attachments">
                        
                                <group string="Attachments">
                                     
                                    <field name="attachment_ids" nolabel="1" readonly="state not in ['new','reviewed']">
                                        <list editable="bottom">
                                            <field name="file" required="1" filename="file_name"/>
                                            <field name="name" required="1"/>
                                            <field name="file_name" invisible="1"/>
                                            <field name="note"/>
                                        </list>
                                    </field>
                                </group>
                            </page>
                            <page string="Notes">
                                <group string="Notes">
                                    <field name="note" nolabel="1" readonly="state not in ['new','reviewed']" />
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <chatter/>
                </form>
            </field>
        </record>



    </data>


</odoo>